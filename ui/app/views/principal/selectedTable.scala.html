@import util._
@import org.apache.commons.collections.CollectionUtils
@import org.apache.chemistry.opencmis.commons.definitions.PermissionDefinition
@import org.apache.chemistry.opencmis.commons.data.Ace

@(title:String)(principals:List[model.Principal]=null)(acl:Map[String, Ace] = null)(permissionDefinitions:List[PermissionDefinition] = null)

@*no more need for contentTemplate frame*@
@contentTemplate()

@*********functions*********@
@contentTemplate() = {
	@defining(("ps-","hoge")){case (prefix,hoge) =>
		<div>
			<legend>@title</legend>
		</div>
		<div>
			<button class='btn btn-default btn-xs' id='@{prefix}remove'><i class="fa fa-times-circle-o"></i>@Messages("view.remove")</button>
		</div>
		
		
		<table class="footable" id="@{prefix}selected-table" data-sort="true" data-page-navigation=".pagination" data-page-size="5">
			<thead>
				<tr>
					<th data-sort-ignore="true"><!-- checkbox --></th>
					<th data-sort-ignore="true">@Messages("view.principal.type")</th>
					<th data-sort-initial="true">@Messages("view.principal.id")</th>
					<th>@Messages("view.principal.name")</th>
					<!-- permission definitions -->
					@if(CollectionUtils.isNotEmpty(permissionDefinitions)){
						@for(pdf <- permissionDefinitions){
							<th>@pdf.getId</th>
						}
						
						<th>@Messages("view.principal.inheritance")</th>
					}
				</tr>
			</thead>
			<tbody>
				@if(CollectionUtils.isNotEmpty(principals)){
				
						@for(p <- principals){
							<tr>
								<td class="@{prefix}remove"><input type='checkbox' principal-id='@p.id' principal-name='@p.name' principal-genre='@p.genre'/></td>
								<td class="@{prefix}genre">@p.genre</td>
								<td class="@{prefix}id">@p.id</td>
								<td class="@{prefix}name">@p.name</td>
								
								<!-- permission definitions -->
								@if(CollectionUtils.isNotEmpty(permissionDefinitions)){
									@for(pdf <- permissionDefinitions if(CollectionUtils.isNotEmpty(permissionDefinitions))){
										<td class="permission-@pdf.getId">
											<input type="checkbox" 
												@if(acl.get(p.id).getPermissions.contains(pdf.getId)){checked="true"} />
										</td>
									}
									
									<td class="inheritance"><input type='checkbox' @if(!acl.get(p.id).isDirect()){checked='true'} /></td>
								}
								
							</tr>
						}
				}
				
			</tbody>
			<tfoot>
				<tr>
					@defining(if(permissionDefinitions == null){4}else{4 + permissionDefinitions.length} + 1){ colspan =>
					<td colspan="@colspan">
					}
						<div class="pagination pagination-centered hide-if-no-paging"></div>
					</td>
				</tr>
			</tfoot>
		</table>
	}
}