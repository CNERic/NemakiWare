@import table._
@import util.Util

@(user:model.User)

@defining(new ArrayList[String]()){ editables =>
	@{
		editables.add("#user-name")
		editables.add("#user-first-name")
		editables.add("#user-last-name")
		editables.add("#user-email")
	}

	<!-- make fields editable -->
	<script type="text/javascript" src="@routes.Assets.at("javascripts/binding-editable.js")"/>
	<script type="text/javascript">
		var editables = [];
		@for(editable <- editables){
			editables.push("@editable");
		}                 
		
		jQuery.each(editables, function(i, editable){
			bindEditable(editable);
		});
	</script>
	<script type="text/javascript">
		//binding: udpate button
		$(document).on('click','#user-update', function(){
			//build data
			var data = {};
			data['userId'] = "@user.id";
			data['userName'] = editedValue('#user-name');
			data['firstName'] = editedValue('#user-first-name');
			data['lastName'] = editedValue('#user-last-name');
			data['email'] = editedValue('#user-email');
			
			//call
			$.ajax({
				url : "@routes.User.update(user.id).absoluteURL(request)",
				type: 'POST',
				data : data,
				success : function(data){
					window.location.reload();
				},
				error : function(XMLHttpRequest, textStatus, errorThrown) {
		            alert("XMLHttpRequest : " + XMLHttpRequest.status);
		            alert("textStatus : " + textStatus);
		            alert("errorThrown : " + errorThrown.message);
		         }
			});
		});
	</script>
	

	@lightbox{
		<div class="container">
			<div class="row">
				<div class="col-sm-5">
					<h3><i class="glyphicon glyphicon-user">@user.name</i></h3>
				</div>
			</div>
	
			<div class="row" style="margin-bottom:15px">
				<div class="col-sm-5">
					<button class="btn btn-default btn-primary" id="user-update"><i class=" glyphicon glyphicon-saved"></i>更新</button>
				</div>
			</div>
			
			<div class="row">
				<div class="col-sm-8">
					<div><h4><i class="glyphicon glyphicon-wrench"></i>プロパティ</h4></div>
					
					<table class="footable" id="user-property-table">
						<thead>
							<tr>
								<th class="col-md-2 col-sm-2">キー</th>
								<th class="col-md-1 col-sm-1"><i class="glyphicon glyphicon-edit" title="更新可能"></i></th>
								<th class="col-md-5 col-sm-5">値</th>
							</tr>
						</thead>
						<tbody>
							<!-- id row -->
							@defining(Util.buildTempStringDefinition(
								"user-id", "ID", true, false, false, null, false
							)){ pdf =>
								@editableRow(pdf)(user.id)()
							}
							<!-- name row -->
							@defining(Util.buildTempStringDefinition(
								"user-name", "名前", true, true, false, null, false
							)){ pdf =>
								@editableRow(pdf)(user.name)()
							}
							<!-- last name row -->
							@defining(Util.buildTempStringDefinition(
								"user-last-name", "姓", false, true, false, null, false
							)){ pdf =>
								@editableRow(pdf)(user.lastName)()
							}
							<!-- first name row -->
							@defining(Util.buildTempStringDefinition(
								"user-first-name", "名", false, true, false, null, false
							)){ pdf =>
								@editableRow(pdf)(user.firstName)()
							}
							<!-- email row -->
							@defining(Util.buildTempStringDefinition(
								"user-email", "メール", false, true, false, null, false
							)){ pdf =>
								@editableRow(pdf)(user.email)()
							}
						</tbody>
					</table>
	
					<hr/>
	
				</div>
			</div>
			
		</div>
		
		
		
	}
	
	
	
}

