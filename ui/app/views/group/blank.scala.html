@import principal._

@lightbox{
	<section class="container">
		<div class="row">
			<div class="col-sm-4">
				@Messages("view.group.create.caption")
			</div>
		</div>
		
		<div class="row">
			<div class="col-sm-8">
				<input type="text" name="groupId" id="new-group-id" placeholder="@Messages("view.group.id")"/><br/>
				<input type="text" name="groupName" id="new-group-name" placeholder="@Messages("view.group.name")"/><br/>
			</div>
		</div>
			
		<div class="row">
			<div class="col-sm-8">@Messages("view.group.member.add")</div>
		</div>
		@principalSearch()
	   	<button class="btn btn-default" id="group-create">@Messages("view.create")</button>
	</section>
}


<!-- scripts -->
<script type="text/javascript">
	//TODO unify similar codes
	$(function () {
		
		//binding: create button
		$(document).on('click','#group-create', function(){
			var users = [];
			var groups = [];
			$('#ps-selected-table :checkbox').each(function(i,chkbx){
				if($(chkbx).attr('principal-genre') == 'user'){
					users.push($(chkbx).attr('principal-id'));	
				}else if($(chkbx).attr('principal-genre') == 'group'){
					groups.push($(chkbx).attr('principal-id'));
				}
			});

			//post
			$.ajax({
				url : "@routes.Group.create().absoluteURL(request)",
				type: 'POST',
				data : {groupId: $('#new-group-id').val(),
						groupName : $('#new-group-name').val(),
						users: JSON.stringify(users),
						groups: JSON.stringify(groups)},
				success : function(data){
					window.location.reload();
				}
			});
		});
	});
</script>

